

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🔬 Contrastive Scaling Laws in Diffusivity Using Neural Networks &mdash; 🤖 GS-HostAgents 0.15 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f41d0df0"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]], "processEscapes": true, "tags": "ams"}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="📘 Kernel Documentation: sfppy.evaluate" href="kernel_doc_SFPPy.html" />
    <link rel="prev" title="🚀 Contrastive Deep Learning in Generative Simulation (GS)" href="Constrastive_Deep-Learning.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            🤖 GS-HostAgents
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">🤖 GS-Agent: Generative Simulation Intelligence Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="Constrastive_Deep-Learning.html">🚀 Contrastive Deep Learning in Generative Simulation (GS)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">🔬 Contrastive Scaling Laws in Diffusivity Using Neural Networks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#abstract">✨ Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#theoretical-background">1. 🧠 Theoretical Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#synthetic-data-generation">2. 🧪 Synthetic Data Generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-configuration">General Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-generation">Data Generation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#contrastive-dataset-construction">3. 🔁 Contrastive Dataset Construction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#neural-network-training">4. 🤖 Neural Network Training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#utility-function-for-calculating-residual-statistics">Utility Function for Calculating Residual Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ann-model">ANN model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#symbolic-regression-baseline">5. 🔢 Symbolic Regression Baseline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visual-diagnostics-performance-metrics">6. 📊 Visual Diagnostics &amp; Performance Metrics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#residuals-distribution">Residuals Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#residuals-vs-predicted">Residuals vs Predicted</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qq-plots">QQ Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shapiro-wilk-tests">Shapiro-Wilk Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#predicted-nn-vs-poly">Predicted NN vs Poly</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dimensionality-reduction-and-scaling-structure">7. 📉 Dimensionality Reduction and Scaling Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hybrid-methodology-scaling-laws">8. 🧩 Hybrid Methodology &amp; Scaling Laws</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">✅ Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#appendix-execution-environment">⚙️ Appendix: Execution Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="kernel_doc_SFPPy.html">📘 Kernel Documentation: sfppy.evaluate</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel_doc_radigen.html">📘 Kernel Documentation: radigen.solve</a></li>
<li class="toctree-l1"><a class="reference internal" href="kernel_doc_sig2dna.html">📘 Kernel Documentation: sig2dna.encode</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">🤖 GS-HostAgents</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">🔬 Contrastive Scaling Laws in Diffusivity Using Neural Networks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ContrastiveScalingD.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="contrastive-scaling-laws-in-diffusivity-using-neural-networks">
<h1>🔬 Contrastive Scaling Laws in Diffusivity Using Neural Networks<a class="headerlink" href="#contrastive-scaling-laws-in-diffusivity-using-neural-networks" title="Link to this heading"></a></h1>
<section id="abstract">
<h2>✨ Abstract<a class="headerlink" href="#abstract" title="Link to this heading"></a></h2>
<p><strong>Contrastive Deep Learning for Generative Simulation (Contrastive GS)</strong> is developed to support fast reasoning when simulation datasets are incomplete or when kernels cannot directly provide an answer to complex engineering or scientific questions. This lecture demonstrates how a neural network can recover <strong>physically meaningful scaling laws</strong> for molecular <strong>diffusivity in polymers</strong>, based only on contrastive ratios. Diffusivity, typically modeled through hole-free volume theory, is governed by temperature, molecular weight, and polymer state (e.g., rubbery vs. glassy).</p>
<p>We show that contrastive deep learning can bridge symbolic physical kernels and black-box inference methods by reconstructing embedded scaling laws from relative data. A neural network is compared with symbolic regression baselines and evaluated through visual diagnostics and dimensionality reduction.</p>
</section>
<hr class="docutils" />
<section id="theoretical-background">
<h2>1. 🧠 Theoretical Background<a class="headerlink" href="#theoretical-background" title="Link to this heading"></a></h2>
<ul>
<li><p>Diffusivity <span class="math notranslate nohighlight">\(D\)</span> of a molecule in a polymer can be modeled as:
$<span class="math notranslate nohighlight">\(
\frac{D}{D_0} = \left(\frac{M}{M_0}\right)^{-\alpha(T,T_g)}
\)</span>$</p>
<div class="math notranslate nohighlight">
\[
    \text{with} \quad \alpha(T,T_g) = 1 + \frac{K_a}{K_b + r(T - T_g)}
    \]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(M\)</span>: molecular weight of the substance</p></li>
<li><p><span class="math notranslate nohighlight">\(M_0\)</span>, <span class="math notranslate nohighlight">\(D_0\)</span>: reference values</p></li>
<li><p><span class="math notranslate nohighlight">\(T\)</span>: temperature in K, <span class="math notranslate nohighlight">\(T_g\)</span>: glass transition temperature</p></li>
<li><p><span class="math notranslate nohighlight">\(r\)</span>: state parameter (<span class="math notranslate nohighlight">\(r=1\)</span> in rubbery state)</p></li>
<li><p><span class="math notranslate nohighlight">\(K_a \approx 140\)</span> K, <span class="math notranslate nohighlight">\(K_b \approx 40\)</span> K (rough estimates here)</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p>📚 <strong>References:</strong></p>
<p>These models are not foundational in a unified theory of mass transport in glassy and rubber polymers based on free volume, cohesive energy, and thermodynamic fluctuations. They are described in detail in:</p>
<ol class="arabic simple">
<li><p>Xiaoyi Fang, Sandra Domenek, Violette Ducruet, Matthieu Réfrégiers, and Olivier Vitrac.<br />
<em>Diffusion of Aromatic Solutes in Aliphatic Polymers above Glass Transition Temperature.</em><br />
<strong>Macromolecules</strong>, 2013, <strong>46</strong> (3), 874–888.<br />
https://doi.org/10.1021/ma3022103</p></li>
<li><p>Yan Zhu, Frank Welle, and Olivier Vitrac.<br />
<em>A Blob Model to Parameterize Polymer Hole Free Volumes and Solute Diffusion.</em><br />
<strong>Soft Matter</strong>, 2019, <strong>15</strong>, 8912–8932.<br />
https://doi.org/10.1039/C9SM01556F</p></li>
</ol>
</div></blockquote>
</section>
<hr class="docutils" />
<section id="synthetic-data-generation">
<h2>2. 🧪 Synthetic Data Generation<a class="headerlink" href="#synthetic-data-generation" title="Link to this heading"></a></h2>
<p>We simulate diffusivity for two polymers (PP and HDPE) with prescribed <span class="math notranslate nohighlight">\(tT_g\)</span> by computing <span class="math notranslate nohighlight">\(D\)</span> across a grid of molecular weights <span class="math notranslate nohighlight">\(M\)</span> and temperatures <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>For each combination of <span class="math notranslate nohighlight">\(M\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, we compute:</p>
<p><span class="math notranslate nohighlight">\(D = D_0 \left(\frac{M}{M_0}\right)^{-\alpha(T,Tg)}\)</span></p>
<section id="general-configuration">
<h3>General Configuration<a class="headerlink" href="#general-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generic configuration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="c1"># add headtail() method to pd</span>
<span class="k">def</span><span class="w"> </span><span class="nf">headtail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ellipsis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">top</span><span class="p">,</span> <span class="n">ellipsis</span><span class="p">,</span> <span class="n">bottom</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">combined</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">headtail</span> <span class="o">=</span> <span class="n">headtail</span>

<span class="c1"># extra pd control</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>        <span class="c1"># Show more rows</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>      <span class="c1"># Show more columns</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.width&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>          <span class="c1"># Set display width</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.float_format&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:.3g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>  <span class="c1"># Format floats</span>

<span class="c1"># plot configuration</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;svg&#39;</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
</pre></div>
</div>
</section>
<section id="data-generation">
<h3>Data Generation<a class="headerlink" href="#data-generation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ka, Kb, M0, D0, and Tg defined above</span>
<span class="c1"># Produces a dataset df with columns: Polymer, M, T, alpha, Dimport numpy as np</span>

<span class="c1"># Constants for the scaling law</span>
<span class="n">Ka</span><span class="p">,</span> <span class="n">Kb</span> <span class="o">=</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">40</span>  <span class="c1"># K</span>

<span class="c1"># Polymers with their Tg and r values</span>
<span class="n">polymers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;PP&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Tg&#39;</span><span class="p">:</span> <span class="mi">273</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="s1">&#39;HDPE&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Tg&#39;</span><span class="p">:</span> <span class="mi">173</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Reference values</span>
<span class="n">M0</span><span class="p">,</span> <span class="n">D0</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">1e-9</span>  <span class="c1"># g/mol, m²/s &lt;-- arbitrary reference</span>

<span class="c1"># Generate a grid of M and T values</span>
<span class="n">M_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># g/mol</span>
<span class="n">T_values_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># °C</span>
<span class="n">T_values</span> <span class="o">=</span> <span class="n">T_values_C</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># Convert to Kelvin</span>

<span class="c1"># Generate synthetic data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">polymer</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">polymers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">Tg</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;Tg&#39;</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">M_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_values</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Ka</span> <span class="o">/</span> <span class="p">(</span><span class="n">Kb</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">Tg</span><span class="p">))</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">D0</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="n">M0</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Polymer&#39;</span><span class="p">:</span> <span class="n">polymer</span><span class="p">,</span>
                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span>
                <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
                <span class="s1">&#39;T_C&#39;</span><span class="p">:</span> <span class="n">T</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span>
                <span class="s1">&#39;Tg&#39;</span><span class="p">:</span> <span class="n">Tg</span><span class="p">,</span>
                <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
                <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">D</span>
            <span class="p">})</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># print df overview</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">headtail</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="c1">#print(df.headtail(10))</span>
</pre></div>
</div>
<p>Here the first 10 and last 10 rows.</p>
<blockquote>
<div><p>💡 Note that <span class="math notranslate nohighlight">\(D\)</span> values are not absolutely scaled in this example since the pre-exponential factor has not been set. It is an approximation of the full problem. <span class="math notranslate nohighlight">\(D\)</span> values are scaled respectively to <span class="math notranslate nohighlight">\(D_0(M_0,T)\)</span>.</p>
</div></blockquote>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Polymer</th>
      <th>M</th>
      <th>T</th>
      <th>Tg</th>
      <th>alpha</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PP</td>
      <td>40</td>
      <td>296</td>
      <td>273</td>
      <td>3.22</td>
      <td>1.91e-08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PP</td>
      <td>40</td>
      <td>309</td>
      <td>273</td>
      <td>2.84</td>
      <td>1.35e-08</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP</td>
      <td>40</td>
      <td>322</td>
      <td>273</td>
      <td>2.58</td>
      <td>1.06e-08</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PP</td>
      <td>40</td>
      <td>335</td>
      <td>273</td>
      <td>2.38</td>
      <td>8.83e-09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PP</td>
      <td>40</td>
      <td>347</td>
      <td>273</td>
      <td>2.22</td>
      <td>7.67e-09</td>
    </tr>
    <tr>
      <th>5</th>
      <td>PP</td>
      <td>40</td>
      <td>360</td>
      <td>273</td>
      <td>2.1</td>
      <td>6.85e-09</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PP</td>
      <td>40</td>
      <td>373</td>
      <td>273</td>
      <td>2</td>
      <td>6.24e-09</td>
    </tr>
    <tr>
      <th>7</th>
      <td>PP</td>
      <td>117</td>
      <td>296</td>
      <td>273</td>
      <td>3.22</td>
      <td>6.09e-10</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PP</td>
      <td>117</td>
      <td>309</td>
      <td>273</td>
      <td>2.84</td>
      <td>6.45e-10</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PP</td>
      <td>117</td>
      <td>322</td>
      <td>273</td>
      <td>2.58</td>
      <td>6.72e-10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>88</th>
      <td>HDPE</td>
      <td>423</td>
      <td>347</td>
      <td>173</td>
      <td>1.65</td>
      <td>9.21e-11</td>
    </tr>
    <tr>
      <th>89</th>
      <td>HDPE</td>
      <td>423</td>
      <td>360</td>
      <td>173</td>
      <td>1.62</td>
      <td>9.71e-11</td>
    </tr>
    <tr>
      <th>90</th>
      <td>HDPE</td>
      <td>423</td>
      <td>373</td>
      <td>173</td>
      <td>1.58</td>
      <td>1.02e-10</td>
    </tr>
    <tr>
      <th>91</th>
      <td>HDPE</td>
      <td>500</td>
      <td>296</td>
      <td>173</td>
      <td>1.86</td>
      <td>5.03e-11</td>
    </tr>
    <tr>
      <th>92</th>
      <td>HDPE</td>
      <td>500</td>
      <td>309</td>
      <td>173</td>
      <td>1.8</td>
      <td>5.56e-11</td>
    </tr>
    <tr>
      <th>93</th>
      <td>HDPE</td>
      <td>500</td>
      <td>322</td>
      <td>173</td>
      <td>1.74</td>
      <td>6.06e-11</td>
    </tr>
    <tr>
      <th>94</th>
      <td>HDPE</td>
      <td>500</td>
      <td>335</td>
      <td>173</td>
      <td>1.69</td>
      <td>6.54e-11</td>
    </tr>
    <tr>
      <th>95</th>
      <td>HDPE</td>
      <td>500</td>
      <td>347</td>
      <td>173</td>
      <td>1.65</td>
      <td>7e-11</td>
    </tr>
    <tr>
      <th>96</th>
      <td>HDPE</td>
      <td>500</td>
      <td>360</td>
      <td>173</td>
      <td>1.62</td>
      <td>7.42e-11</td>
    </tr>
    <tr>
      <th>97</th>
      <td>HDPE</td>
      <td>500</td>
      <td>373</td>
      <td>173</td>
      <td>1.58</td>
      <td>7.83e-11</td>
    </tr>
  </tbody>
</table>
</section>
</section>
<hr class="docutils" />
<section id="contrastive-dataset-construction">
<h2>3. 🔁 Contrastive Dataset Construction<a class="headerlink" href="#contrastive-dataset-construction" title="Link to this heading"></a></h2>
<p>Instead of absolute diffusivities, we focus on <strong>pairwise contrastive ratios</strong>:</p>
<p><span class="math notranslate nohighlight">\(y = \log\left(\frac{D_i}{D_j}\right) = -\alpha \cdot \log\left(\frac{M_i}{M_j}\right)\)</span></p>
<p><strong>Contrastive features:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_1 = \log(M_i/M_j)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_2 = 1/T_i - 1/T_j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(x_3 = T_{g,i} - T_{g,j}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(y = \log(D_i/D_j)\)</span></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generates contrastive_df with inputs and log-ratio targets</span>
<span class="c1"># %% Contrastive Data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>

<span class="c1"># Create contrastive pairs</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;logD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">])</span>
<span class="n">contrastive_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">polymer</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Polymer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Polymer&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polymer</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">row_i</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">row_j</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">logD_ratio</span> <span class="o">=</span> <span class="n">row_i</span><span class="p">[</span><span class="s1">&#39;logD&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row_j</span><span class="p">[</span><span class="s1">&#39;logD&#39;</span><span class="p">]</span>
        <span class="n">logM_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">row_i</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">row_j</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">])</span>
        <span class="n">invT_diff</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">row_i</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">row_j</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
        <span class="n">Tg_diff</span> <span class="o">=</span> <span class="n">row_i</span><span class="p">[</span><span class="s1">&#39;Tg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row_j</span><span class="p">[</span><span class="s1">&#39;Tg&#39;</span><span class="p">]</span>

        <span class="n">contrastive_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;Polymer&#39;</span><span class="p">:</span> <span class="n">polymer</span><span class="p">,</span>
            <span class="s1">&#39;logM_ratio&#39;</span><span class="p">:</span> <span class="n">logM_ratio</span><span class="p">,</span>
            <span class="s1">&#39;invT_diff&#39;</span><span class="p">:</span> <span class="n">invT_diff</span><span class="p">,</span>
            <span class="s1">&#39;Tg_diff&#39;</span><span class="p">:</span> <span class="n">Tg_diff</span><span class="p">,</span>
            <span class="s1">&#39;logD_ratio&#39;</span><span class="p">:</span> <span class="n">logD_ratio</span>
        <span class="p">})</span>

<span class="n">contrastive_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">contrastive_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">contrastive_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> contrastive pairs&quot;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">contrastive_df</span><span class="o">.</span><span class="n">headtail</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="c1">#print(contrastive_df.headtail(10))</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Generated 2352 contrastive pairs
</pre></div>
</div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Polymer</th>
      <th>logM_ratio</th>
      <th>invT_diff</th>
      <th>Tg_diff</th>
      <th>logD_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PP</td>
      <td>0</td>
      <td>0.00014</td>
      <td>0</td>
      <td>0.343</td>
    </tr>
    <tr>
      <th>1</th>
      <td>PP</td>
      <td>0</td>
      <td>0.000269</td>
      <td>0</td>
      <td>0.587</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PP</td>
      <td>0</td>
      <td>0.000388</td>
      <td>0</td>
      <td>0.769</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PP</td>
      <td>0</td>
      <td>0.000499</td>
      <td>0</td>
      <td>0.911</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PP</td>
      <td>0</td>
      <td>0.000601</td>
      <td>0</td>
      <td>1.02</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2347</th>
      <td>HDPE</td>
      <td>0</td>
      <td>0.000213</td>
      <td>0</td>
      <td>-0.126</td>
    </tr>
    <tr>
      <th>2348</th>
      <td>HDPE</td>
      <td>0</td>
      <td>0.000308</td>
      <td>0</td>
      <td>-0.179</td>
    </tr>
    <tr>
      <th>2349</th>
      <td>HDPE</td>
      <td>0</td>
      <td>0.000102</td>
      <td>0</td>
      <td>-0.0593</td>
    </tr>
    <tr>
      <th>2350</th>
      <td>HDPE</td>
      <td>0</td>
      <td>0.000198</td>
      <td>0</td>
      <td>-0.112</td>
    </tr>
    <tr>
      <th>2351</th>
      <td>HDPE</td>
      <td>0</td>
      <td>9.54e-05</td>
      <td>0</td>
      <td>-0.053</td>
    </tr>
  </tbody>
</table>
</section>
<hr class="docutils" />
<section id="neural-network-training">
<h2>4. 🤖 Neural Network Training<a class="headerlink" href="#neural-network-training" title="Link to this heading"></a></h2>
<section id="utility-function-for-calculating-residual-statistics">
<h3>Utility Function for Calculating Residual Statistics<a class="headerlink" href="#utility-function-for-calculating-residual-statistics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_residuals</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_true</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s2">&quot;predicted&quot;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="s2">&quot;residuals&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="p">,</span>
        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
        <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)),</span>
        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">residuals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># initialization of the container dict</span>
<span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;NN&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="s2">&quot;poly&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ann-model">
<h3>ANN model<a class="headerlink" href="#ann-model" title="Link to this heading"></a></h3>
<p>We train a <em>small</em> 3-layer feedforward neural network on the scaled contrastive features.</p>
<p><strong>Model:</strong> 3 inputs → 32 ReLU → 32 ReLU → 1 output</p>
<blockquote>
<div><p>Change nNN to test different values</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PyTorch model training with MSELoss over 500 epochs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>

<span class="c1"># ----- Preprocessing -----</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">contrastive_df</span><span class="p">[[</span><span class="s1">&#39;logM_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;invT_diff&#39;</span><span class="p">,</span> <span class="s1">&#39;Tg_diff&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">contrastive_df</span><span class="p">[</span><span class="s1">&#39;logD_ratio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">y_scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">X_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">y_scaled</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Split the contrastive_df into training and test sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y_scaled</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Convert to tensors</span>
<span class="n">X_train_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_train_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">X_test_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_test_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># ----- Neural Network -----</span>
<span class="n">nNN</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ContrastiveNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nNN</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">nNN</span><span class="p">,</span> <span class="n">nNN</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">nNN</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ContrastiveNet</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">loss_fn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

<span class="c1"># ----- Training Loop -----</span>
<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train_tensor</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fn</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_train_tensor</span><span class="p">)</span>
    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

<span class="c1"># ----- Evaluation and inverse transform -----</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">y_train_pred_scaled</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">y_test_pred_scaled</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_test_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># Inverse scaling</span>
    <span class="n">y_train_pred_NN</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train_pred_scaled</span><span class="p">)</span>
    <span class="n">y_test_pred_NN</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test_pred_scaled</span><span class="p">)</span>
    <span class="n">y_train_true</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_test_true</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

<span class="c1"># ----- R² scores -----</span>
<span class="n">r2_train_nn</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_NN</span><span class="p">)</span>
<span class="n">r2_test_nn</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_NN</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contrastive NN R² score (train): </span><span class="si">{</span><span class="n">r2_train_nn</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contrastive NN R² score (test): </span><span class="si">{</span><span class="n">r2_test_nn</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Fill diagnostics for NN</span>
<span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_residuals</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_NN</span><span class="p">)</span>
<span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">][</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_residuals</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_NN</span><span class="p">)</span>


<span class="c1"># ----- Plotting -----</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Train set</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train_pred_NN</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Train set: Contrastive NN&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True logD_ratio&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted logD_ratio&quot;</span><span class="p">)</span>

<span class="c1"># Test set</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test_pred_NN</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Test set: Contrastive NN&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True logD_ratio&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted logD_ratio&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig01.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<p>✅ Final <span class="math notranslate nohighlight">\(R^2\)</span> typically &gt; 0.85 on validation set (test).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Contrastive NN R² score (train): 0.8884
Contrastive NN R² score (test): 0.8886
</pre></div>
</div>
<p><img alt="Dfig01" src="assets/Dfig01.svg" /></p>
</section>
</section>
<hr class="docutils" />
<section id="symbolic-regression-baseline">
<h2>5. 🔢 Symbolic Regression Baseline<a class="headerlink" href="#symbolic-regression-baseline" title="Link to this heading"></a></h2>
<p>We fit a degree-2 polynomial regression as a symbolic benchmark on the same dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># %% symbolic regression</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="c1"># Split the contrastive_df into training and test sets</span>
<span class="c1">#train_df, test_df = train_test_split(contrastive_df, test_size=0.2, random_state=0)</span>
<span class="c1"># Training data</span>
<span class="c1">#X_train = train_df[[&#39;logM_ratio&#39;, &#39;invT_diff&#39;, &#39;Tg_diff&#39;]].values</span>
<span class="c1">#y_train = train_df[&#39;logD_ratio&#39;].values</span>
<span class="c1"># Test data</span>
<span class="c1">#X_test = test_df[[&#39;logM_ratio&#39;, &#39;invT_diff&#39;, &#39;Tg_diff&#39;]].values</span>
<span class="c1">#y_test = test_df[&#39;logD_ratio&#39;].values</span>

<span class="c1"># Use preprocessed and scaled data from earlier (same as NN)</span>
<span class="c1"># X_train, X_test, y_train, y_test already exist</span>

<span class="c1"># Symbolic regression surrogate: polynomial regression</span>
<span class="c1"># Regression pipeline (degree-2 polynomial regression)</span>
<span class="n">poly_model</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">LinearRegression</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">poly_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Predict on scaled data</span>
<span class="n">y_train_pred_poly</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">poly_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="n">y_test_pred_poly</span> <span class="o">=</span> <span class="n">y_scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">poly_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Training set</span>
<span class="c1">#sns.scatterplot(x=y_train, y=y_train_pred, ax=axs[0])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train_pred_poly</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_train_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Train set: Symbolic (poly) regression&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True logD_ratio&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted logD_ratio&quot;</span><span class="p">)</span>

<span class="c1"># Test set</span>
<span class="c1">#sns.scatterplot(x=y_test, y=y_test_pred, ax=axs[1])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test_pred_poly</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_test_true</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Test set: Symbolic (poly) regression&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;True logD_ratio&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted logD_ratio&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig02.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Return test and training R² scores</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>
<span class="n">r2_train</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_poly</span><span class="p">)</span>
<span class="n">r2_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_poly</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contrastive NN R² score (train): </span><span class="si">{</span><span class="n">r2_train</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contrastive NN R² score (test): </span><span class="si">{</span><span class="n">r2_test</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Fill diagnostics for poly regression</span>
<span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_residuals</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred_poly</span><span class="p">)</span>
<span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="s2">&quot;test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_residuals</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred_poly</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Dfig00" src="assets/Dfig02.svg" /></p>
<p>Pros:</p>
<ul class="simple">
<li><p>Transparent and interpretable</p></li>
<li><p>Limited expressivity</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="visual-diagnostics-performance-metrics">
<h2>6. 📊 Visual Diagnostics &amp; Performance Metrics<a class="headerlink" href="#visual-diagnostics-performance-metrics" title="Link to this heading"></a></h2>
<p>We compare:</p>
<ul class="simple">
<li><p>Predicted vs. actual</p></li>
<li><p><span class="math notranslate nohighlight">\(R^2\)</span> on training and test sets</p></li>
<li><p>RMSE and residual distributions (mean, std)</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="k">def</span><span class="w"> </span><span class="nf">safe_fmt</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="s2">&quot;—&quot;</span>

<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_stats</span> <span class="ow">in</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">model_stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
            <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">,</span>
            <span class="s2">&quot;R²&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">),</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Mean Residual&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Std Residual&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Min Residual&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Max Residual&quot;</span><span class="p">:</span> <span class="n">safe_fmt</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">df_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

<span class="c1"># Render as HTML</span>
<span class="n">html_table</span> <span class="o">=</span> <span class="n">df_stats</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-striped&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_table</span><span class="p">))</span>
</pre></div>
</div>
<table class="dataframe table table-striped">
  <thead>
    <tr style="text-align: right;">
      <th>Model</th>
      <th>Dataset</th>
      <th>R²</th>
      <th>RMSE</th>
      <th>Mean Residual</th>
      <th>Std Residual</th>
      <th>Min Residual</th>
      <th>Max Residual</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>NN</td>
      <td>train</td>
      <td>0.8884</td>
      <td>0.5776</td>
      <td>-0.0002</td>
      <td>0.5776</td>
      <td>-2.7300</td>
      <td>1.3251</td>
    </tr>
    <tr>
      <td>NN</td>
      <td>test</td>
      <td>0.8886</td>
      <td>0.5655</td>
      <td>-0.0260</td>
      <td>0.5649</td>
      <td>-2.9169</td>
      <td>1.1259</td>
    </tr>
    <tr>
      <td>poly</td>
      <td>train</td>
      <td>0.8866</td>
      <td>0.5822</td>
      <td>0.0000</td>
      <td>0.5822</td>
      <td>-2.6753</td>
      <td>1.2800</td>
    </tr>
    <tr>
      <td>poly</td>
      <td>test</td>
      <td>0.8912</td>
      <td>0.5590</td>
      <td>-0.0237</td>
      <td>0.5585</td>
      <td>-2.8470</td>
      <td>1.1021</td>
    </tr>
  </tbody>
</table>
<p>We continue with</p>
<ul class="simple">
<li><p>Residuals vs predicted</p></li>
<li><p>Histograms</p></li>
<li><p>QQ plots (normality)</p></li>
<li><p>Shapiro-Wilk test for normality</p></li>
</ul>
<section id="residuals-distribution">
<h3>Residuals Distribution<a class="headerlink" href="#residuals-distribution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">shapiro</span>

<span class="c1"># Assume diagnostics is already defined and populated</span>
<span class="c1"># We&#39;ll now define the plotting code using it</span>

<span class="n">figures</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># 1. Histogram of Residuals</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NN Train&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">][</span><span class="s2">&quot;test&quot;</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NN Test&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="s2">&quot;train&quot;</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Poly Train&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="s2">&quot;test&quot;</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Poly Test&#39;</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Histogram of Residuals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Residual (Predicted - True)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">figures</span><span class="p">[</span><span class="s2">&quot;Histogram of Residuals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig03.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<p><img alt="Dfig03" src="assets/Dfig03.svg" /></p>
</section>
<section id="residuals-vs-predicted">
<h3>Residuals vs Predicted<a class="headerlink" href="#residuals-vs-predicted" title="Link to this heading"></a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. Residuals vs Predicted</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">,</span> <span class="s2">&quot;poly&quot;</span><span class="p">]</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;NN Train&quot;</span><span class="p">,</span> <span class="s2">&quot;NN Test&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Poly Train&quot;</span><span class="p">,</span> <span class="s2">&quot;Poly Test&quot;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">diagnostics</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">],</span>
            <span class="n">diagnostics</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2">: Residuals vs Predicted&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted logD_ratio&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residual&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">figures</span><span class="p">[</span><span class="s2">&quot;Residuals vs Predicted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig04.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="Dfig04" src="assets/Dfig04.svg" /></p>
</section>
<section id="qq-plots">
<h3>QQ Plots<a class="headerlink" href="#qq-plots" title="Link to this heading"></a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. QQ-Plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">],</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;QQ-Plot: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1"> Residuals&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">figures</span><span class="p">[</span><span class="s2">&quot;QQ Plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig05.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="Dfig05" src="assets/Dfig05.svg" /></p>
<p>📈 <strong>Residual plots</strong>, QQ plots, and predicted vs. actual comparisons confirm:</p>
<ul class="simple">
<li><p>NN learns smooth trends across contrastive pairs</p></li>
<li><p>Symbolic model shows visible bias near domain boundaries</p></li>
</ul>
</section>
<section id="shapiro-wilk-tests">
<h3>Shapiro-Wilk Tests<a class="headerlink" href="#shapiro-wilk-tests" title="Link to this heading"></a></h3>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. Shapiro-Wilk Tests</span>
<span class="n">shapiro_results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;residuals&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">diagnostics</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">diagnostics</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">shapiro_summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span><span class="n">model</span><span class="p">,</span>
        <span class="s2">&quot;dataset&quot;</span><span class="p">:</span><span class="n">dataset</span><span class="p">,</span>
        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span>
        <span class="s2">&quot;p-value&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">pvalue</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">),</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">shapiro_results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>


<span class="n">df_shapiro</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shapiro_summary</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">html_table</span> <span class="o">=</span> <span class="n">df_shapiro</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">&quot;table table-striped&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html_table</span><span class="p">))</span>

<span class="n">figures</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c1"># Return list of generated figure titles</span>
</pre></div>
</div>
<table class="dataframe table table-striped">
  <thead>
    <tr style="text-align: right;">
      <th>model</th>
      <th>dataset</th>
      <th>W</th>
      <th>p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>NN</td>
      <td>train</td>
      <td>0.962</td>
      <td>1.05e-21</td>
    </tr>
    <tr>
      <td>NN</td>
      <td>test</td>
      <td>0.948</td>
      <td>7.42e-12</td>
    </tr>
    <tr>
      <td>poly</td>
      <td>train</td>
      <td>0.962</td>
      <td>6.96e-22</td>
    </tr>
    <tr>
      <td>poly</td>
      <td>test</td>
      <td>0.951</td>
      <td>1.94e-11</td>
    </tr>
  </tbody>
</table>
</section>
<section id="predicted-nn-vs-poly">
<h3>Predicted NN vs Poly<a class="headerlink" href="#predicted-nn-vs-poly" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 5. Predicted NN vs Poly</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">],</span>
        <span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;NN&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">])],</span>
        <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;poly&quot;</span><span class="p">][</span><span class="n">dataset</span><span class="p">][</span><span class="s2">&quot;predicted&quot;</span><span class="p">])],</span>
        <span class="s1">&#39;k--&#39;</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted NN vs Poly (</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Poly predicted logD_ratio&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;NN predicted logD_ratio&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">figures</span><span class="p">[</span><span class="s2">&quot;NN vs Poly Predicted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig06.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="Dfig06" src="assets/Dfig06.svg" /></p>
<ul class="simple">
<li></li>
</ul>
</section>
</section>
<section id="dimensionality-reduction-and-scaling-structure">
<h2>7. 📉 Dimensionality Reduction and Scaling Structure<a class="headerlink" href="#dimensionality-reduction-and-scaling-structure" title="Link to this heading"></a></h2>
<p>We apply <strong>PCA on the contrastive input space</strong> to identify dominant modes and assess feature redundancy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fast PCA on inputs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X_proj</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="c1"># Extract explained variance</span>
<span class="n">expl_var</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># in percent</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_proj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_proj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PCA Component 1 (</span><span class="si">{</span><span class="n">expl_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PCA Component 2 (</span><span class="si">{</span><span class="n">expl_var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA Projection of Contrastive Features&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&quot;assets/Dfig08.svg&quot;, format=&#39;svg&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="Dfig08" src="assets/Dfig08.svg" /></p>
<p>📌 This reveals:</p>
<ul class="simple">
<li><p>Polynomial nonlinearity captured by NN</p></li>
<li><p>Clusters driven by polymer type or <span class="math notranslate nohighlight">\(T_g\)</span></p></li>
<li><p>Orthogonality between <span class="math notranslate nohighlight">\(\log(M_i/M_j)\)</span> and <span class="math notranslate nohighlight">\(1/T_i - 1/T_j\)</span></p></li>
<li><p>Regions where contrastive predictions may be unstable</p></li>
</ul>
<p>👉 Consider also <strong>PCoA</strong> on a log-transformed contrastive distance matrix when the dataset violates Euclidean assumptions.</p>
</section>
<hr class="docutils" />
<section id="hybrid-methodology-scaling-laws">
<h2>8. 🧩 Hybrid Methodology &amp; Scaling Laws<a class="headerlink" href="#hybrid-methodology-scaling-laws" title="Link to this heading"></a></h2>
<p><strong>Contrastive GS</strong> bridges:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Symbolic Kernels</p></th>
<th class="head"><p>Deep Learning Inference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Known physics (<span class="math notranslate nohighlight">\(D \propto M^{-\alpha}\)</span>)</p></td>
<td><p>Hidden structure in data</p></td>
</tr>
<tr class="row-odd"><td><p>Few interpretable parameters</p></td>
<td><p>High-capacity estimators</p></td>
</tr>
</tbody>
</table>
<p>🔗 <strong>Vaschy-Buckingham <span class="math notranslate nohighlight">\(\pi\)</span>-theorem</strong> provides a theoretical basis for using invariant ratios in log-space.</p>
<p>🧠 Neural networks extract these invariant manifolds from contrastive pairs without ever seeing absolute quantities.</p>
<p>📐 Sparse Additive Models (e.g., Lasso) may also be used to impose partial structure.</p>
</section>
<hr class="docutils" />
<section id="conclusion">
<h2>✅ Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>This case study demonstrates that <strong>contrastive training</strong> can:</p>
<ul class="simple">
<li><p>Recover physically meaningful <strong>scaling laws</strong> from partial data</p></li>
<li><p>Yield generalizable, nonlinear predictors</p></li>
<li><p>Be validated against symbolic models and diagnostics</p></li>
</ul>
<p>Contrastive GS provides a robust framework for learning in <strong>simulation-scarce</strong>, <strong>data-structured</strong>, and <strong>physics-informed</strong> environments.</p>
</section>
<hr class="docutils" />
<section id="appendix-execution-environment">
<h2>⚙️ Appendix: Execution Environment<a class="headerlink" href="#appendix-execution-environment" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>PyTorch with CUDA 12.4</p></li>
<li><p>scikit-learn, seaborn, matplotlib</p></li>
<li><p>Fully reproducible on local GPU or CPU</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Constrastive_Deep-Learning.html" class="btn btn-neutral float-left" title="🚀 Contrastive Deep Learning in Generative Simulation (GS)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="kernel_doc_SFPPy.html" class="btn btn-neutral float-right" title="📘 Kernel Documentation: sfppy.evaluate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Olivier Vitrac (Generative Simulation).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>